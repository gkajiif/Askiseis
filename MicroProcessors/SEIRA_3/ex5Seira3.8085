

LXI H,0000H
MVI C,40H
MVI A,0EH
SIM
EI
MAIN: JMP MAIN

RST5.5:
	JMP INTR_HANDLE

INTR_HANDLE:
	MOV A,C
	RRC
	JC READ_MSB		; READ MSB WHEN READ COUNT IS ODD
	JNZ READ_MSB

READ_LSB:
	IN 40H
	ANI 1FH
	MOV B,A
	DCR C
	EI
	RET

READ_MSB:
	IN 40H
	ANI 1FH
	RLC
	RLC
	RLC
	RLC
	ORA B

	MVI D,00H
	MOV E,A		; D = 0, E = A
	
	; 16-BIT ADDITION IN H-L
	DAD D
	
	DCR C
	JZ CALC_MEAN
	EI
	RET

CALC_MEAN:
	; SHIFT 4 BITS TO THE RIGHT

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A	

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A	

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A

	MOV A,H
	RAR	
	MOV H,A		
	MOV A,L
	RAR
	MOV L,A

	HLT		; RESULT IN L
END	